name: Docker Build

inputs:
  java-version:
    description: Java version
    required: false
    default: '21'
  java-distributor:
    description: Java distributor
    required: false
    default: temurin
  working-directory:
    description: Directory of project on github
    required: false
    default: .
  artifact-name:
    description: Name of build artifact
    required: false
    default: app-build
  image-name:
    description: Docker image name
    required: true
  image-tag:
    description: Docker image tag
    required: true

runs:
  using: composite
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Download Build Artifact
      uses: actions/download-artifact@v4
      with:
        name: ${{ inputs.artifact-name }}

    - name: Find downloaded JAR
      shell: bash
      run: |
        JAR_PATH=$(ls ${{ inputs.working-directory }}/*.jar | head -n 1)
        echo "Found JAR: $JAR_PATH"
        echo "JAR_PATH=$JAR_PATH" >> $GITHUB_ENV

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Build Docker image
      shell: bash
      run: |
        docker build \
          --build-arg JAVA_VERSION=${{ inputs.java-version }} \
          --build-arg JAVA_DISTRIBUTION=${{ inputs.java-distribution }} \
          --build-arg JAR_FILE=$JAR_PATH \
          -f ${{ inputs.dockerfile }} \
          -t ${{ inputs.image-name }}:${{ inputs.image-tag }} \
          ${{ inputs.working-directory }} \
          .